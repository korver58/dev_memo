# FROM ruby:3.4.2-slim
FROM ruby:slim
# ENV ASCIIDOCTOR_VERSION=2.0.20 \
#     ASCIIDOCTOR_PDF_VERSION=2.3.13

RUN apt-get update && apt-get install -y \
    gcc g++ \
    && rm -rf /var/lib/apt/lists/*

# RUN gem install \
#     asciidoctor:${ASCIIDOCTOR_VERSION} \
#     asciidoctor-pdf:${ASCIIDOCTOR_PDF_VERSION}

RUN gem install \
    asciidoctor \
    asciidoctor-pdf

ARG USER_ID
ARG GROUP_ID

RUN groupadd -g ${GROUP_ID} developer && \
    useradd -u ${USER_ID} -g developer -m developer

WORKDIR /documents
RUN chown developer:developer /documents

USER developer

WORKDIR /documents
CMD ["/bin/bash"]

services:
    app:
      build:
        context: .
        dockerfile: Dockerfile
        args:
          USER_ID: "${UID:-1020}"  # クォートで囲む
          GROUP_ID: "${GID:-1020}" # クォートで囲む
      volumes:
        - .:/documents
      working_dir: /documents
      network_mode: "host"
      tty: true
      stdin_open: true
  